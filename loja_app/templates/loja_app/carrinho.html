<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrinho de Compras - Loja Nutri</title>
    <link rel="stylesheet" href="{% static 'styles.css' %}">
</head>
<body>
    <h1>Carrinho de Compras</h1>

    {% if carrinho_items %}
        <div id="carrinho-cheio" class="carrinho">
            <table>
                <thead>
                    <tr>
                        <th>Produto</th>
                        <th>Preço</th>
                        <th>Quantidade</th>
                        <th>Total</th>
                        <th>Remover</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in carrinho_items %}
                        <tr>
                            <td>{{ item.produto.nome }}</td>
                            <td>R$ {{ item.produto.preco }}</td>
                            <td>
                                <input type="number" value="{{ item.quantidade }}" min="1" onchange="atualizarTotal()">
                            </td>
                            <td class="total-item">R$ {{ item.total }}</td>
                            <td>
                                <form method="POST" action="{% url 'remover_do_carrinho' item.id %}">
                                    {% csrf_token %}
                                    <button type="submit">Remover</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="total-carrinho">
                <p><strong>Total:</strong> R$ <span id="total-carrinho">{{ total }}</span></p>
            </div>

            <div class="acoes-carrinho">
                <a href="{% url 'produtos' %}">
                    <button>Continuar Comprando</button>
                </a>
                <a href="{% url 'finalizar_compra' %}">
                    <button>Finalizar Compra</button>
                </a>
            </div>
        </div>
    {% else %}
        <div id="carrinho-vazio" class="carrinho">
            <h2>Seu Carrinho está Vazio</h2>
            <p>Adicione ebooks ao seu carrinho para continuar a compra.</p>
            <a href="{% url 'produtos' %}">
                <button>Continuar Comprando</button>
            </a>
        </div>
    {% endif %}
    
    <script>
        // Atualizar o total após alteração da quantidade
        function atualizarTotal() {
            let totalCarrinho = 0;
            let itens = document.querySelectorAll('#itens-carrinho tr');
            
            itens.forEach(function(item) {
                let preco = parseFloat(item.cells[1].innerText.replace('R$ ', '').replace(',', '.'));
                let quantidade = parseInt(item.querySelector('input').value);
                let totalItem = preco * quantidade;
                item.querySelector('.total-item').innerText = 'R$ ' + totalItem.toFixed(2).replace('.', ',');
                
                totalCarrinho += totalItem;
            });

            document.getElementById('total-carrinho').innerText = totalCarrinho.toFixed(2).replace('.', ',');
        }
    </script>
</body>
</html>
